<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Client Information Form</title>
    <style>
        * {
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f5f5;
            margin: 0;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.1);
            width: 100%;
        }
        
        h1 {
            text-align: center;
            color: #25D366;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
            padding-bottom: 15px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }
        
        input[type="text"],
        input[type="tel"],
        input[type="email"],
        input[type="date"],
        textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
            transition: border 0.3s;
        }
        
        input:focus,
        textarea:focus {
            border-color: #25D366;
            outline: none;
            box-shadow: 0 0 5px rgba(37, 211, 102, 0.3);
        }
        
        .required {
            color: #e74c3c;
        }
        
        .form-row {
            display: flex;
            flex-wrap: wrap;
            margin: 0 -15px;
        }
        
        .form-col {
            flex: 1;
            padding: 0 15px;
            min-width: 250px;
        }
        
        button {
            background-color: #25D366;
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 5px;
            cursor: pointer;
            width: 100%;
            margin-top: 20px;
            transition: background-color 0.3s;
            font-weight: bold;
        }
        
        button:hover {
            background-color: #128C7E;
        }
        
        .whatsapp-icon {
            display: inline-block;
            vertical-align: middle;
            margin-right: 10px;
            font-size: 24px;
        }
        
        .instructions {
            background-color: #e1f7e9;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 25px;
            font-size: 14px;
            border-left: 4px solid #25D366;
        }
        
        .button-group {
            display: flex;
            gap: 10px;
        }
        
        .clear-btn {
            background-color: #e74c3c;
        }
        
        .clear-btn:hover {
            background-color: #c0392b;
        }
        
        /* Passport Image Upload Styles */
        .passport-upload-container {
            margin: 25px 0;
            padding: 20px;
            background-color: #f8f9fa;
            border-radius: 10px;
            border: 2px dashed #dee2e6;
            text-align: center;
        }
        
        .passport-upload-label {
            display: block;
            margin-bottom: 15px;
            font-weight: 600;
            font-size: 18px;
            color: #495057;
        }
        
        .passport-upload-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%) !important;
            color: white !important;
            border: none !important;
            padding: 20px 40px !important;
            font-size: 18px !important;
            border-radius: 8px !important;
            cursor: pointer !important;
            transition: all 0.3s ease !important;
            font-weight: bold !important;
            display: inline-flex !important;
            align-items: center !important;
            gap: 12px !important;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2) !important;
            width: auto !important;
            margin: 0 !important;
        }
        
        .passport-upload-btn:hover {
            transform: translateY(-2px) !important;
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3) !important;
            background: linear-gradient(135deg, #764ba2 0%, #667eea 100%) !important;
        }
        
        .passport-upload-icon {
            font-size: 24px;
        }
        
        .passport-preview-container {
            margin-top: 20px;
            display: none;
        }
        
        .passport-preview {
            max-width: 100%;
            max-height: 450px;
            border: 3px solid #e9ecef;
            border-radius: 8px;
            object-fit: contain;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            margin: 0 auto;
            display: block;
            background-color: white;
        }
        
        .passport-remove-btn {
            background-color: #e74c3c !important;
            color: white !important;
            border: none !important;
            padding: 8px 16px !important;
            border-radius: 5px !important;
            cursor: pointer !important;
            margin-top: 10px !important;
            font-size: 14px !important;
            width: auto !important;
        }
        
        .passport-remove-btn:hover {
            background-color: #c0392b !important;
        }
        
        .file-input {
            display: none !important;
        }
        
        .upload-instructions {
            font-size: 14px;
            color: #6c757d;
            margin-top: 10px;
            line-height: 1.4;
        }
        
        .image-size-info {
            font-size: 12px;
            color: #868e96;
            margin-top: 5px;
            font-style: italic;
        }
        
        .checkbox-group {
            display: flex;
            align-items: flex-start;
            margin-top: 25px;
            padding: 15px;
            background-color: #f9f9f9;
            border-radius: 5px;
        }
        
        .checkbox-group input {
            margin-right: 10px;
            margin-top: 3px;
        }
        
        .checkbox-group label {
            font-weight: normal;
            margin-bottom: 0;
        }

        @media (max-width: 768px) {
            .form-col {
                flex: 100%;
            }
            
            .container {
                padding: 15px;
                max-width: 100%;
            }
            
            .button-group {
                flex-direction: column;
            }
            
            .passport-upload-btn {
                padding: 15px 30px !important;
                font-size: 16px !important;
            }
            
            .form-row {
                margin: 0 -10px;
            }
            
            .form-col {
                padding: 0 10px;
                min-width: 200px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>
            <span class="whatsapp-icon">ðŸ“±</span>
            Client Information Form
        </h1>
        
        <div class="instructions">
            <p><strong>Instructions:</strong> Please fill out all required fields. Your data will be automatically saved as you type. Once completed, click the "Capture Image" button to generate a summary image.</p>
        </div>
        
        <form id="clientForm">
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="name">Name <span class="required">*</span></label>
                        <input type="text" id="name" name="name" required>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="middleName">Middle Name</label>
                        <input type="text" id="middleName" name="middleName">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="surname">Surname <span class="required">*</span></label>
                        <input type="text" id="surname" name="surname" required>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="email">Email <span class="required">*</span></label>
                <input type="email" id="email" name="email" required>
            </div>
            
            <div class="form-group">
                <label for="address1">Address Line 1 <span class="required">*</span></label>
                <input type="text" id="address1" name="address1" required>
            </div>
            
            <div class="form-group">
                <label for="streetName">Street Name</label>
                <input type="text" id="streetName" name="streetName">
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="town">Town <span class="required">*</span></label>
                        <input type="text" id="town" name="town" required>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="county">County</label>
                        <input type="text" id="county" name="county">
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="postCode">Post Code <span class="required">*</span></label>
                        <input type="text" id="postCode" name="postCode" required>
                    </div>
                </div>
            </div>
            
            <div class="form-group">
                <label for="mobile">Mobile No. <span class="required">*</span></label>
                <input type="tel" id="mobile" name="mobile" required>
            </div>
            
            <div class="form-group">
                <label for="dob">Date of Birth <span class="required">*</span></label>
                <input type="date" id="dob" name="dob" required>
            </div>
            
            <!-- Passport Image Upload Section -->
            <div class="passport-upload-container">
                <label class="passport-upload-label">Passport Image Upload</label>
                <button type="button" class="passport-upload-btn" id="uploadBtn">
                    <span class="passport-upload-icon">ðŸ“·</span>
                    Upload Passport Image
                </button>
                <input type="file" id="fileInput" class="file-input" accept="image/*">
                <div class="upload-instructions">
                    <p>Upload a high-quality image of your passport</p>
                </div>
                
                <div class="passport-preview-container" id="previewContainer">
                    <img id="previewImg" class="passport-preview" alt="Passport preview">
                    <div id="imageSizeInfo" class="image-size-info"></div>
                    <button type="button" class="passport-remove-btn" id="removeBtn">Remove Image</button>
                </div>
            </div>
            
            <div class="form-row">
                <div class="form-col">
                    <div class="form-group">
                        <label for="passportNo">Passport No. <span class="required">*</span></label>
                        <input type="text" id="passportNo" name="passportNo" required>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="passportIssue">Passport Issue Date <span class="required">*</span></label>
                        <input type="date" id="passportIssue" name="passportIssue" required>
                    </div>
                </div>
                <div class="form-col">
                    <div class="form-group">
                        <label for="passportExpiry">Passport Expiry Date <span class="required">*</span></label>
                        <input type="date" id="passportExpiry" name="passportExpiry" required>
                    </div>
                </div>
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="confirmation" name="confirmation" required>
                <label for="confirmation">I confirm that the deposit amount of Â£250 is non-refundable and non-transferable once paid, and I acknowledge and accept these terms.<span class="required">*</span></label>
            </div>
            
            <div class="form-group">
                <label for="comments">Comments</label>
                <textarea id="comments" name="comments" rows="4" placeholder="Add any additional comments here..."></textarea>
            </div>
            
            <div class="button-group">
                <button type="button" id="captureBtn">
                    <span class="whatsapp-icon">ðŸ“·</span>
                    Capture Form
                </button>
                <button type="button" id="clearBtn" class="clear-btn">
                    Clear Form
                </button>
            </div>
        </form>
    </div>

    <!-- Capture container -->
    <div id="captureContainer" style="display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.8); z-index: 9999; justify-content: center; align-items: center;">
        <div style="background: white; padding: 20px; border-radius: 10px; max-width: 90%; max-height: 90%; overflow: auto; text-align: center;">
            <h2>Document Preview</h2>
            <div id="processingIndicator" style="display: none; color: #3498db; margin: 20px 0;">Processing document...</div>
            <div id="capturePreview"></div>
            <div style="margin-top: 20px;">
                <button onclick="closeCaptureModal()" style="background: #95a5a6; color: white; padding: 10px 20px; border: none; border-radius: 5px; cursor: pointer; margin: 5px;">Close</button>
            </div>
        </div>
    </div>

    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script>
        // Simple, reliable passport upload functionality
        document.addEventListener('DOMContentLoaded', function() {
            console.log('DOM loaded - setting up passport upload');
            
            const uploadBtn = document.getElementById('uploadBtn');
            const fileInput = document.getElementById('fileInput');
            const previewContainer = document.getElementById('previewContainer');
            const previewImg = document.getElementById('previewImg');
            const removeBtn = document.getElementById('removeBtn');
            const imageSizeInfo = document.getElementById('imageSizeInfo');
            
            console.log('Elements:', {
                uploadBtn: !!uploadBtn,
                fileInput: !!fileInput,
                previewContainer: !!previewContainer,
                previewImg: !!previewImg,
                removeBtn: !!removeBtn
            });
            
            if (uploadBtn && fileInput) {
                uploadBtn.onclick = function(e) {
                    e.preventDefault();
                    console.log('Upload button clicked!');
                    fileInput.click();
                };
                
                fileInput.onchange = function(e) {
                    console.log('File input changed');
                    const file = e.target.files[0];
                    
                    if (file) {
                        console.log('File selected:', file.name);
                        
                        if (!file.type.startsWith('image/')) {
                            alert('Please select a valid image file.');
                            return;
                        }
                        
                        const reader = new FileReader();
                        reader.onload = function(event) {
                            console.log('File loaded successfully');
                            previewImg.src = event.target.result;
                            previewContainer.style.display = 'block';
                            
                            previewImg.onload = function() {
                                const info = `Image: ${previewImg.naturalWidth} Ã— ${previewImg.naturalHeight} pixels`;
                                imageSizeInfo.textContent = info;
                                console.log(info);
                            };
                        };
                        
                        reader.onerror = function() {
                            console.error('Error reading file');
                            alert('Error reading file. Please try again.');
                        };
                        
                        reader.readAsDataURL(file);
                    }
                };
                
                if (removeBtn) {
                    removeBtn.onclick = function(e) {
                        e.preventDefault();
                        console.log('Remove button clicked');
                        previewImg.src = '';
                        previewContainer.style.display = 'none';
                        fileInput.value = '';
                        imageSizeInfo.textContent = '';
                    };
                }
            } else {
                console.error('Required elements not found!');
            }
            
            // Clear form functionality
            const clearBtn = document.getElementById('clearBtn');
            if (clearBtn) {
                clearBtn.onclick = function() {
                    if (confirm('Are you sure you want to clear all form data?')) {
                        document.getElementById('clientForm').reset();
                        previewContainer.style.display = 'none';
                        previewImg.src = '';
                        imageSizeInfo.textContent = '';
                    }
                };
            }
            
            // Capture functionality
            const captureBtn = document.getElementById('captureBtn');
            if (captureBtn) {
                captureBtn.onclick = function() {
                    captureForm();
                };
            }
        });
        
        // Capture form functionality
        function captureForm() {
            console.log('Starting form capture...');
            
            // Basic validation
            const requiredFields = document.querySelectorAll('input[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.style.borderColor = '#e74c3c';
                } else {
                    field.style.borderColor = '#ddd';
                }
            });
            
            const confirmationCheckbox = document.getElementById('confirmation');
            if (!confirmationCheckbox.checked) {
                isValid = false;
                alert('Please accept the deposit conditions.');
                return;
            }
            
            if (!isValid) {
                alert('Please fill in all required fields.');
                return;
            }
            
            // Show processing
            document.getElementById('captureContainer').style.display = 'flex';
            document.getElementById('processingIndicator').style.display = 'block';
            
            // Create capture content
            createCaptureContent();
        }
        
        function createCaptureContent() {
            // Hide buttons and passport preview section for clean Page 1 capture
            const elementsToHide = [
                document.querySelector('.button-group'),
                document.querySelector('.passport-upload-container') // Hide entire passport section for Page 1
            ];
            
            const originalDisplays = [];
            elementsToHide.forEach((element, index) => {
                if (element) {
                    originalDisplays[index] = element.style.display;
                    element.style.display = 'none';
                }
            });
            
            // Get the actual form container
            const formContainer = document.querySelector('.container');
            
            // Wait a moment for the DOM to update
            setTimeout(() => {
                // Temporarily adjust form container for better capture
                const originalMaxWidth = formContainer.style.maxWidth;
                const originalMargin = formContainer.style.margin;
                const originalPadding = formContainer.style.padding;
                
                formContainer.style.maxWidth = '1000px';
                formContainer.style.margin = '0 auto';
                formContainer.style.padding = '40px';
                
                // Capture the actual form as it appears with all content
                html2canvas(formContainer, {
                    scale: 1.2,
                    useCORS: true,
                    backgroundColor: '#ffffff',
                    allowTaint: false,
                    logging: false,
                    height: formContainer.scrollHeight,
                    width: formContainer.scrollWidth
                }).then(canvas => {
                    // Restore original styles
                    formContainer.style.maxWidth = originalMaxWidth;
                    formContainer.style.margin = originalMargin;
                    formContainer.style.padding = originalPadding;
                    // Restore hidden elements
                    elementsToHide.forEach((element, index) => {
                        if (element) {
                            element.style.display = originalDisplays[index] || '';
                        }
                    });
                    
                    // Check if we have a passport image for separate page
                    const passportImg = document.getElementById('previewImg');
                    const hasPassport = passportImg && passportImg.src && passportImg.src.startsWith('data:') && 
                                       document.getElementById('previewContainer').style.display !== 'none';
                    
                    if (hasPassport) {
                        createPassportPage(canvas);
                    } else {
                        // Just the form
                        displayAndDownload(canvas, 'client-information-form.png');
                    }
                }).catch(error => {
                    console.error('Error capturing form:', error);
                    
                    // Restore original styles on error
                    formContainer.style.maxWidth = originalMaxWidth;
                    formContainer.style.margin = originalMargin;
                    formContainer.style.padding = originalPadding;
                    
                    // Restore hidden elements on error
                    elementsToHide.forEach((element, index) => {
                        if (element) {
                            element.style.display = originalDisplays[index] || '';
                        }
                    });
                    
                    document.getElementById('processingIndicator').innerHTML = 'Error capturing form. Please try again.';
                });
            }, 100);
        }
        
        function createPassportPage(formCanvas) {
            const passportContainer = document.createElement('div');
            passportContainer.style.width = '800px';
            passportContainer.style.height = '600px';
            passportContainer.style.backgroundColor = 'white';
            passportContainer.style.padding = '40px';
            passportContainer.style.display = 'flex';
            passportContainer.style.flexDirection = 'column';
            passportContainer.style.alignItems = 'center';
            passportContainer.style.justifyContent = 'center';
            passportContainer.style.position = 'absolute';
            passportContainer.style.left = '-9999px';
            passportContainer.style.top = '0';
            
            const title = document.createElement('h2');
            title.textContent = 'Passport Image';
            title.style.textAlign = 'center';
            title.style.marginBottom = '30px';
            title.style.fontSize = '28px';
            title.style.color = '#333';
            
            const img = document.createElement('img');
            img.src = document.getElementById('previewImg').src;
            img.style.maxWidth = '600px';
            img.style.maxHeight = '400px';
            img.style.objectFit = 'contain';
            img.style.border = '2px solid #333';
            img.style.borderRadius = '8px';
            
            passportContainer.appendChild(title);
            passportContainer.appendChild(img);
            document.body.appendChild(passportContainer);
            
            html2canvas(passportContainer, {
                scale: 1,
                useCORS: true,
                backgroundColor: '#ffffff'
            }).then(passportCanvas => {
                document.body.removeChild(passportContainer);
                
                // Combine both canvases
                const combinedCanvas = document.createElement('canvas');
                const ctx = combinedCanvas.getContext('2d');
                
                combinedCanvas.width = Math.max(formCanvas.width, passportCanvas.width);
                combinedCanvas.height = formCanvas.height + passportCanvas.height + 50;
                
                ctx.fillStyle = '#ffffff';
                ctx.fillRect(0, 0, combinedCanvas.width, combinedCanvas.height);
                
                ctx.drawImage(formCanvas, 0, 0);
                ctx.drawImage(passportCanvas, 0, formCanvas.height + 50);
                
                displayAndDownload(combinedCanvas, 'client-information-with-passport.png');
            }).catch(error => {
                console.error('Error capturing passport:', error);
                document.body.removeChild(passportContainer);
                displayAndDownload(formCanvas, 'client-information-form.png');
            });
        }
        
        function displayAndDownload(canvas, filename) {
            document.getElementById('processingIndicator').style.display = 'none';
            
            const preview = document.getElementById('capturePreview');
            preview.innerHTML = '';
            
            const img = document.createElement('img');
            img.src = canvas.toDataURL('image/png');
            img.style.maxWidth = '100%';
            img.style.maxHeight = '600px';
            img.style.border = '1px solid #ddd';
            img.style.borderRadius = '5px';
            
            const downloadBtn = document.createElement('button');
            downloadBtn.textContent = 'Download Image';
            downloadBtn.style.background = '#25D366';
            downloadBtn.style.color = 'white';
            downloadBtn.style.padding = '10px 20px';
            downloadBtn.style.border = 'none';
            downloadBtn.style.borderRadius = '5px';
            downloadBtn.style.cursor = 'pointer';
            downloadBtn.style.margin = '10px';
            
            downloadBtn.onclick = function() {
                const link = document.createElement('a');
                link.download = filename;
                link.href = canvas.toDataURL('image/png');
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            };
            
            preview.appendChild(img);
            preview.appendChild(document.createElement('br'));
            preview.appendChild(downloadBtn);
        }
        
        function closeCaptureModal() {
            document.getElementById('captureContainer').style.display = 'none';
            document.getElementById('capturePreview').innerHTML = '';
        }
    </script>
</body>
</html>
